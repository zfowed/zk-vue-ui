(("undefined"!==typeof self?self:this)["webpackJsonpzkm_vue_ui"]=("undefined"!==typeof self?self:this)["webpackJsonpzkm_vue_ui"]||[]).push([[16],{"0dac":function(t,e,n){"use strict";n.r(e);n("7f7f");var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"zk-imagehtml-container"},[n("div",{ref:"html",class:["zk-imagehtml-html",{"zk-imagehtml-hide":!t.loading}],style:{width:t.parentWidth&&t.parentWidth+"px",height:t.parentHeight&&t.parentHeight+"px"}},[t._t("default")],2),n("img",{directives:[{name:"show",rawName:"v-show",value:!t.loading,expression:"!loading"}],staticClass:"zk-imagehtml-image",attrs:{src:t.src}})])},i=[],r=n("75fc"),s=(n("551c"),n("34ef"),n("4917"),n("28a5"),n("7867")),l=n("c0e9"),o=n.n(l);function u(t){return t.toDataURL("image/png")}function h(t){var e=t.split(","),n=e[0].match(/:(.*?);/)[1],a=atob(e[1]),i=a.length,r=new Uint8Array(i);while(i--)r[i]=a.charCodeAt(i);return new Blob([r],{type:n})}function c(t){return URL.createObjectURL(t)}var d={name:"ZkHtmlImage",props:["data"],data:function(){return{status:"idle",src:"",parentWidth:void 0,parentHeight:void 0}},computed:{loading:function(){return"idle"!==this.status}},watch:{data:{deep:!0,handler:"update"},loading:function(){this.loading&&this.$el}},methods:{htmlImgLoad:function(){var t=this;return new Promise(function(e,n){var a=0;t.htmlImgLoadTimer=setInterval(function(){return a+=1,t.$refs.html&&!Object(r["a"])(t.$refs.html.querySelectorAll("img")).some(function(t){return!t.complete})?(a=null,clearInterval(t.htmlImgLoadTimer),setTimeout(e,0)):a>=50?(a=null,clearInterval(t.htmlImgLoadTimer),n(new Error("加载图片超时！"))):void 0},0)})},update:function(){var t=this;if(this.$refs.html&&"wait"!==this.status){if("run"!==this.status)return this.status="run",this.updateSrc().then(function(){if("wait"===t.status)return t.status="idle",t.update();t.status="idle"});this.status="wait"}},updateSrc:function(){var t=this;if(this.$refs.html&&!this.__isUpdateSrc)return this.__isUpdateSrc=!0,this.htmlImgLoad().then(function(){return t.parentWidth=t.$refs.html.parentNode.clientWidth,t.parentHeight=t.$refs.html.parentNode.clientHeight,o()(t.$refs.html,{backgroundColor:"#FFFFFF",allowTaint:!1,useCORS:!0,logging:!1})}).then(function(e){var n=u(e);if(t.bata64!==n){t.bata64=n;var a=h(n),i=c(a);t.src=i}},function(){t.src="",Object(s["b"])("加载失败！")}).then(function(){t.__isUpdateSrc=!1})}},mounted:function(){this.update()},destroyed:function(){clearInterval(this.aaaa),this.loadingInstance&&this.loadingInstance.close(),this.htmlImgLoadTimer&&clearInterval(this.htmlImgLoadTimer)}},m=d,f=(n("8f41"),n("2877")),p=Object(f["a"])(m,a,i,!1,null,"284269f6",null),g=p.exports;g.install=function(t){t.component(g.name,g)};e["default"]=g},"8f41":function(t,e,n){"use strict";var a=n("d2b8"),i=n.n(a);i.a},d2b8:function(t,e,n){}}]);
//# sourceMappingURL=zkm-vue-ui.umd.min.zk-html-image.js.map